version: 1

repo:
  path: /home/user/code/kilroy

cxdb:
  binary_addr: 127.0.0.1:9009
  http_base_url: http://127.0.0.1:9010
  autostart:
    enabled: true
    command:
      - /home/user/code/kilroy/scripts/start-cxdb.sh
    wait_timeout_ms: 60000
    poll_interval_ms: 250
    ui:
      url: http://127.0.0.1:9010

llm:
  cli_profile: real
  providers:
    cerebras:
      backend: api
      failover: [zai]
      api:
        protocol: openai_chat_completions
        api_key_env: CEREBRAS_API_KEY
        base_url: https://api.cerebras.ai
        path: /v1/chat/completions
        profile_family: openai
    zai:
      backend: api
      failover: [cerebras]
      api:
        protocol: openai_chat_completions
        api_key_env: ZAI_API_KEY
        base_url: https://api.z.ai
        path: /api/coding/paas/v4/chat/completions
        profile_family: openai

modeldb:
  openrouter_model_info_path: /home/user/code/kilroy/internal/attractor/modeldb/pinned/openrouter_models.json
  openrouter_model_info_update_policy: pinned

git:
  require_clean: false
  run_branch_prefix: attractor/run
  commit_per_node: true

setup:
  timeout_ms: 900000
  commands:
    - 'docker inspect -f "{{.State.Running}}" kilroy-cxdb 2>/dev/null | grep -qx true || { echo "real CXDB container kilroy-cxdb is not running" >&2; exit 1; }'
    - 'curl -fsS http://127.0.0.1:9010/v1/contexts >/dev/null || { echo "CXDB HTTP API not reachable" >&2; exit 1; }'
    - 'command -v cargo >/dev/null || { echo "missing required tool: cargo (install via rustup.rs)" >&2; exit 1; }'
    - 'command -v rustup >/dev/null || { echo "missing required tool: rustup (install via rustup.rs)" >&2; exit 1; }'
    - 'command -v wasm-pack >/dev/null || cargo install wasm-pack'
    - 'rustup target list --installed | grep -qx wasm32-unknown-unknown || rustup target add wasm32-unknown-unknown'

runtime_policy:
  stage_timeout_ms: 0
  stall_timeout_ms: 1800000
  stall_check_interval_ms: 5000
  max_llm_retries: 2

preflight:
  prompt_probes:
    enabled: true
    transports: [complete]
    timeout_ms: 60000
    retries: 1
    base_delay_ms: 500
    max_delay_ms: 5000
